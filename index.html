<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mission Shakti 5.0 Certificate Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent:#0b63d3;
    }
    body{margin:0;font-family:'Noto Sans Devanagari',sans-serif;background:#f3f4f6;color:#111}
    .container{max-width:1100px;margin:20px auto;padding:16px}
    .layout{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media (max-width:900px){.layout{grid-template-columns:1fr}}
    .card{background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
    h1{font-size:20px;margin-bottom:12px}
    label{font-size:14px;display:block;margin-top:8px}
    input{width:100%;padding:8px;border:1px solid #ccc;border-radius:8px;margin-top:4px}
    .actions{margin-top:14px;display:flex;flex-wrap:wrap;gap:8px}
    button{padding:10px 14px;border:none;border-radius:8px;background:var(--accent);color:#fff;cursor:pointer}
    button.secondary{background:#6b7280}

    .preview-wrap{display:flex;justify-content:center;align-items:center;padding:12px}
    .certificate-frame{width:100%;max-width:800px;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden;background:#eee}
    .cert-preview{position:relative;width:100%;padding-top:56.69%;background-size:cover;background-position:center}

    /* XY positions based on uploaded design */
    .cert-element{position:absolute;color:#000}
    .ref-no{top:4%;left:4%;font-size:14px;font-family:'Poppins',sans-serif}
    .date{top:4%;right:4%;font-size:14px;font-family:'Poppins',sans-serif}
    .cert-name{top:32%;left:0;right:0;text-align:center;font-size:36px;font-weight:700}
    .cert-hindi{top:46%;left:8%;right:8%;text-align:center;font-size:20px;line-height:1.6}

  </style>
</head>
<body>
  <div class="container">
    <h1>Mission Shakti 5.0 Certificate Generator</h1>
    <div class="layout">
      <div class="card">
        <label>नाम (Name)</label>
        <input id="name" placeholder="पूरा नाम" />
        <label>पिता / पति का नाम (Father/Husband Name)</label>
        <input id="father" placeholder="पिता / पति का नाम" />
        <label>मोबाइल नंबर (Mobile No.)</label>
        <input id="mobile" placeholder="मोबाइल नंबर" />
        <label>ईमेल (Email)</label>
        <input id="email" placeholder="Email" />
        <label>बैकग्राउंड इमेज (backgroundimage.jpg)</label>
        <input type="file" id="bgfile" accept="image/*" />
        <button class="secondary" id="useRepoBg">Use repo background</button>
        <div class="actions">
          <button id="generate">Update Preview</button>
          <button id="downloadPng">Download PNG (HD)</button>
          <button id="downloadPdf">Download PDF</button>
          <button id="downloadJpg">Download JPG (HD)</button>
        </div>
      </div>
      <div class="card preview-wrap">
        <div class="certificate-frame">
          <div id="preview" class="cert-preview" style="background-image:url('backgroundimage.jpg')">
            <div class="cert-element ref-no">Reference No.: 025452545255/GOV01/KSJ</div>
            <div class="cert-element date" id="pDate">Date: 10/10/2025</div>
            <div class="cert-element cert-name" id="pName">&lt;&lt;Name&gt;&gt;</div>
            <div class="cert-element cert-hindi" id="pHindi">
              पिता/पति &lt;&lt;Father or Husband name&gt;&gt; को मिशन शक्ति 5.0 के अंतर्गत महिला सशक्तिकरण के लिए उनके उत्कृष्ट योगदान, भागीदारी और प्रतिबद्धता के लिए गर्व से नगर पंचायत उदाहरण, जनपद कासगंज द्वारा प्रदान किया जाता है। उनका समर्पण नारी सुरक्षा, नारी सम्मान और नारी स्वावलंबन की भावना को दर्शाता है।
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    const EXPORT_WIDTH = 3508;
    const EXPORT_HEIGHT = 2480;

    const nameInput = document.getElementById('name');
    const fatherInput = document.getElementById('father');
    const mobileInput = document.getElementById('mobile');
    const emailInput = document.getElementById('email');
    const bgfile = document.getElementById('bgfile');
    const useRepoBg = document.getElementById('useRepoBg');
    const preview = document.getElementById('preview');
    const pName = document.getElementById('pName');
    const pHindi = document.getElementById('pHindi');
    const pDate = document.getElementById('pDate');

    function updatePreview(){
      const name = nameInput.value.trim() || '<<Name>>';
      const father = fatherInput.value.trim() || '<<Father or Husband name>>';
      pName.textContent = name;
      pHindi.textContent = `पिता/पति ${father} को मिशन शक्ति 5.0 के अंतर्गत महिला सशक्तिकरण के लिए उनके उत्कृष्ट योगदान, भागीदारी और प्रतिबद्धता के लिए गर्व से नगर पंचायत उदाहरण, जनपद कासगंज द्वारा प्रदान किया जाता है। उनका समर्पण नारी सुरक्षा, नारी सम्मान और नारी स्वावलंबन की भावना को दर्शाता है।`;
      pDate.textContent = `Date: ${new Date().toLocaleDateString()}`;
    }

    document.getElementById('generate').addEventListener('click', e=>{e.preventDefault();updatePreview();});
    useRepoBg.addEventListener('click',e=>{e.preventDefault();preview.style.backgroundImage = "url('backgroundimage.jpg')"});
    bgfile.addEventListener('change',ev=>{const f=ev.target.files[0];if(!f)return;preview.style.backgroundImage = `url(${URL.createObjectURL(f)})`;});

    async function renderExportCanvas(){
      const name = nameInput.value.trim() || '<<Name>>';
      const father = fatherInput.value.trim() || '<<Father or Husband name>>';
      const canvas = document.createElement('canvas');
      canvas.width = EXPORT_WIDTH;
      canvas.height = EXPORT_HEIGHT;
      const ctx = canvas.getContext('2d');

      let bgSrc = bgfile.files[0] ? URL.createObjectURL(bgfile.files[0]) : 'backgroundimage.jpg';
      const bgImg = await loadImage(bgSrc);
      ctx.drawImage(bgImg, 0, 0, EXPORT_WIDTH, EXPORT_HEIGHT);

      ctx.fillStyle = '#000';
      ctx.textAlign = 'left';
      ctx.font = '36px Poppins';
      ctx.fillText('Reference No.: 025452545255/GOV01/KSJ', EXPORT_WIDTH*0.04, EXPORT_HEIGHT*0.06);
      ctx.textAlign = 'right';
      ctx.fillText(`Date: ${new Date().toLocaleDateString()}`, EXPORT_WIDTH*0.96, EXPORT_HEIGHT*0.06);

      ctx.textAlign = 'center';
      ctx.font = '80px Noto Sans Devanagari';
      ctx.fillText(name, EXPORT_WIDTH/2, EXPORT_HEIGHT*0.35);

      ctx.font = '40px Noto Sans Devanagari';
      wrapText(ctx,`पिता/पति ${father} को मिशन शक्ति 5.0 के अंतर्गत महिला सशक्तिकरण के लिए उनके उत्कृष्ट योगदान, भागीदारी और प्रतिबद्धता के लिए गर्व से नगर पंचायत उदाहरण, जनपद कासगंज द्वारा प्रदान किया जाता है। उनका समर्पण नारी सुरक्षा, नारी सम्मान और नारी स्वावलंबन की भावना को दर्शाता है।`,EXPORT_WIDTH/2,EXPORT_HEIGHT*0.48,EXPORT_WIDTH*0.84,50);

      return canvas;
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight){
      const words = text.split(' ');
      let line = '';
      for(let n=0;n<words.length;n++){
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        if(metrics.width > maxWidth && n>0){
          ctx.fillText(line,x,y);
          line = words[n] + ' ';
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line,x,y);
    }

    function loadImage(src){
      return new Promise((res,rej)=>{const img=new Image();img.crossOrigin='anonymous';img.onload=()=>res(img);img.onerror=rej;img.src=src;});
    }

    function downloadURI(uri,name){const a=document.createElement('a');a.href=uri;a.download=name;document.body.appendChild(a);a.click();a.remove();}

    document.getElementById('downloadPng').addEventListener('click',async e=>{
      e.preventDefault();
      const canvas=await renderExportCanvas();
      downloadURI(canvas.toDataURL('image/png'),`certificate_${Date.now()}.png`);
    });

    document.getElementById('downloadJpg').addEventListener('click',async e=>{
      e.preventDefault();
      const canvas=await renderExportCanvas();
      downloadURI(canvas.toDataURL('image/jpeg',0.95),`certificate_${Date.now()}.jpg`);
    });

    document.getElementById('downloadPdf').addEventListener('click',async e=>{
      e.preventDefault();
      const canvas=await renderExportCanvas();
      const imgData=canvas.toDataURL('image/png');
      if(typeof jspdf==='undefined') await loadScript('https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js');
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({orientation:'landscape',unit:'pt',format:'a4'});
      const pdfWidth = doc.internal.pageSize.getWidth();
      const pdfHeight = doc.internal.pageSize.getHeight();
      doc.addImage(imgData,'PNG',0,0,pdfWidth,pdfHeight);
      doc.save(`certificate_${Date.now()}.pdf`);
    });

    function loadScript(src){return new Promise((resolve,reject)=>{const s=document.createElement('script');s.src=src;s.onload=resolve;s.onerror=reject;document.head.appendChild(s);});}

    updatePreview();
  </script>
</body>
</html>
